<?xml version="1.0" ?>

<container xmlns="http://symfony.com/schema/dic/services"
           xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
           xsi:schemaLocation="http://symfony.com/schema/dic/services http://symfony.com/schema/dic/services/services-1.0.xsd">
				
    <parameters>
        <parameter key="fosubuserprovider.properties" type="collection">
            <parameter key="twitter">twitterId</parameter>
        </parameter>         
        <parameter key="class.guzzle.response">Guzzle\Http\Message\Response</parameter>
        <parameter key="class.guzzle.client">Guzzle\Http\Client</parameter>
        <parameter key="class.guzzle.oauthplugin">Guzzle\Plugin\Oauth\OauthPlugin</parameter>
        <parameter key="littlebigjoe.media.provider.dailymotion.class">LittleBigJoe\Bundle\FrontendBundle\Provider\DailymotionProvider</parameter>
        <parameter key="littlebigjoe.media.provider.youtube.class">LittleBigJoe\Bundle\FrontendBundle\Provider\YoutubeProvider</parameter>
        <parameter key="littlebigjoe.media.provider.vimeo.class">LittleBigJoe\Bundle\FrontendBundle\Provider\VimeoProvider</parameter>
        <parameter key="littlebigjoe.media.provider.factory.class">LittleBigJoe\Bundle\FrontendBundle\Provider\ProviderFactory</parameter>
        <!--<parameter key="twig.exception_listener.controller">LittleBigJoe\Bundle\FrontendBundle\Controller\TwigExceptionController::showAction</parameter>-->
        <parameter key="twig.controller.exception.class">LittleBigJoe\Bundle\FrontendBundle\Controller\TwigExceptionController</parameter>
    </parameters>
		
    <services>
        <service id="littlebigjoefrontend.user_listener" class="LittleBigJoe\Bundle\FrontendBundle\EventListener\UserListener">
            <argument type="service" id="security.context" />
            <tag name="kernel.event_subscriber" />
            <tag name="kernel.event_listener" event="security.interactive_login" />
        </service>
        <service id="littlebigjoefrontend.user.registration" class="LittleBigJoe\Bundle\FrontendBundle\Form\RegistrationFormTypeBeta" scope="request">
            <tag name="form.type" alias="littlebigjoe_bundle_frontendbundle_user_registration_beta"/>
            <argument type="service" id="session" />
            <argument>%fos_user.model.user.class%</argument>
            <argument type="service" id="service_container" />
        </service>
        <service id="littlebigjoefrontend.user.profile" class="LittleBigJoe\Bundle\FrontendBundle\Form\ProfileFormType" scope="request">
            <tag name="form.type" alias="littlebigjoe_bundle_frontendbundle_user_profile"/>
            <argument>%fos_user.model.user.class%</argument>
            <argument type="service" id="service_container" />
        </service>
        <service id="littlebigjoefrontend.user.facebook_provider" class="LittleBigJoe\Bundle\FrontendBundle\Security\Provider\FacebookProvider">
            <argument type="service" id="fos_facebook.api" />
            <argument type="service" id="fos_user.user_manager" />
            <argument type="service" id="validator" />
            <argument type="service" id="service_container" />
            <argument>%fos_user.model.user.class%</argument>
        </service>
        <service id="littlebigjoefrontend.fos_ub_user_provider" class="LittleBigJoe\Bundle\FrontendBundle\Security\Provider\FOSUBUserProvider" public="false">
            <argument type="service" id="fos_user.user_manager" />
            <argument>%fosubuserprovider.properties%</argument>
            <argument type="service" id="service_container" />
        </service>
        <service id="littlebigjoefrontend.listener.user.registration" class="LittleBigJoe\Bundle\FrontendBundle\EventListener\RegistrationListener">
            <tag name="kernel.event_subscriber"/>
            <argument type="service" id="service_container"/>
        </service>
        <service id="littlebigjoefrontend.listener.user.profile" class="LittleBigJoe\Bundle\FrontendBundle\EventListener\ProfileListener">
            <tag name="kernel.event_subscriber"/>
            <argument type="service" id="service_container"/>
            <argument type="service" id="security.context"/>
        </service>
        <service id="littlebigjoefrontend.project.createProject" class="LittleBigJoe\Bundle\FrontendBundle\Form\CreateProjectFormType">
            <tag name="form.type" alias="createProject" />
    	</service>
   		<service id="littlebigjoefrontend.flow.project.createProject" class="LittleBigJoe\Bundle\FrontendBundle\Form\CreateProjectFlow" parent="craue.form.flow" scope="request">
            <call method="setFormType">
            	<argument type="service" id="littlebigjoefrontend.project.createProject" />
        	</call>
            <call method="setEntityManager">
                <argument type="service" id="doctrine.orm.entity_manager"/>
            </call>
    	</service>

        <service id="littlebigjoefrontend.project.editProject" class="LittleBigJoe\Bundle\FrontendBundle\Form\EditProjectFormType">
            <tag name="form.type" alias="editProject" />
        </service>
        <service id="littlebigjoefrontend.flow.project.editProject" class="LittleBigJoe\Bundle\FrontendBundle\Form\EditProjectFlow" parent="craue.form.flow" scope="request">
            <call method="setFormType">
                <argument type="service" id="littlebigjoefrontend.project.editProject" />
            </call>
            <call method="setEntityManager">
                <argument type="service" id="doctrine.orm.entity_manager"/>
            </call>
        </service>

        <service id="littlebigjoefrontend.project.createProduct" class="LittleBigJoe\Bundle\FrontendBundle\Form\CreateProductFormType">
            <tag name="form.type" alias="createProduct" />
        </service>
        <service id="littlebigjoefrontend.flow.project.createProduct" class="LittleBigJoe\Bundle\FrontendBundle\Form\CreateProductFlow" parent="craue.form.flow" scope="request">
            <call method="setFormType">
                <argument type="service" id="littlebigjoefrontend.project.createProduct" />
            </call>
            <call method="setEntityManager">
                <argument type="service" id="doctrine.orm.entity_manager"/>
            </call>
        </service>

        <service id="littlebigjoe.media.provider.dailymotion" class="%littlebigjoe.media.provider.dailymotion.class%">
            <argument type="service" id="littlebigjoe.media.buzz.browser" />
            <argument type="service" id="templating" />
        </service>

        <service id="littlebigjoe.media.provider.youtube" class="%littlebigjoe.media.provider.youtube.class%">
            <argument type="service" id="littlebigjoe.media.buzz.browser" />
            <argument type="service" id="templating" />
        </service>

        <service id="littlebigjoe.media.provider.vimeo" class="%littlebigjoe.media.provider.vimeo.class%">
            <argument type="service" id="littlebigjoe.media.buzz.browser" />
            <argument type="service" id="templating" />
        </service>

        <service id="littlebigjoe.media.buzz.browser" class="Buzz\Browser">
        </service>

        <service id="littlebigjoe.media.provider.factory" class="%littlebigjoe.media.provider.factory.class%">
            <argument type="service" id="littlebigjoe.media.provider.dailymotion" />
            <argument type="service" id="littlebigjoe.media.provider.youtube" />
            <argument type="service" id="littlebigjoe.media.provider.vimeo" />
        </service>
    </services>
</container>
